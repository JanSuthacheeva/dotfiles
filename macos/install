#!/usr/bin/env bash

set -e

DOTFILES=$(cd $(dirname "${BASH_SOURCE[0]}")/.. && pwd)

echo "Installing macOS dotfiles..."

# Check and install Ghostty
if ! command -v ghostty &> /dev/null; then
    echo "Ghostty not found. Installing via Homebrew..."
    brew install --cask ghostty
else
    echo "Ghostty already installed"
fi

# Set up Ghostty config symlink
echo "Setting up Ghostty config..."
rm -rf $HOME/.config/ghostty
ln -s $DOTFILES/macos/ghostty $HOME/.config/ghostty

# Check and install Neovim
if ! command -v nvim &> /dev/null; then
    echo "Neovim not found. Installing via Homebrew..."
    brew install neovim
else
    echo "Neovim already installed"
fi

# Set up Neovim config symlink
echo "Setting up Neovim config..."
rm -rf $HOME/.config/nvim
ln -s $DOTFILES/nvim $HOME/.config/nvim

# Check and install AeroSpace
if ! command -v aerospace &> /dev/null; then
    echo "AeroSpace not found. Installing via Homebrew..."
    brew install --cask nikitabobko/tap/aerospace
else
    echo "AeroSpace already installed"
fi

# Set up AeroSpace config symlink
echo "Setting up AeroSpace config..."
rm -rf $HOME/.aerospace.toml
ln -s $DOTFILES/macos/aerospace/.aerospace.toml $HOME/.aerospace.toml

# Check and install Sketchybar
if ! command -v sketchybar &> /dev/null; then
    echo "Sketchybar not found. Installing via Homebrew..."
    brew install sketchybar
else
    echo "Sketchybar already installed"
fi

# Set up Sketchybar config symlink
echo "Setting up Sketchybar config..."
rm -rf $HOME/.config/sketchybar
ln -s $DOTFILES/macos/sketchybar $HOME/.config/sketchybar

# Set up app-icons symlink
echo "Setting up app-icons..."
rm -rf $HOME/.config/app-icons
ln -s $DOTFILES/macos/app-icons $HOME/.config/app-icons

# Check and install Borders
if ! command -v borders &> /dev/null; then
    echo "Borders not found. Installing via Homebrew..."
    brew install borders
else
    echo "Borders already installed"
fi

# Set up Borders config symlink
echo "Setting up Borders config..."
rm -rf $HOME/.config/borders
ln -s $DOTFILES/macos/borders $HOME/.config/borders

# Set up Zsh config
echo "Setting up Zsh config..."
rm -f $HOME/.zshrc
ln -s $DOTFILES/macos/zsh/.zshrc $HOME/.zshrc

# Set up Powerlevel10k config
echo "Setting up Powerlevel10k config..."
rm -f $HOME/.p10k.zsh
ln -s $DOTFILES/macos/p10k/.p10k.zsh $HOME/.p10k.zsh

# Set up tmux config
echo "Setting up tmux config..."
rm -f $HOME/.tmux.conf
ln -s $DOTFILES/tmux/tmux.conf $HOME/.tmux.conf

# Set up Claude Code config
echo "Setting up Claude Code config..."
mkdir -p $HOME/.claude
rm -f $HOME/.claude/CLAUDE.md
ln -s $DOTFILES/claude/CLAUDE.md $HOME/.claude/CLAUDE.md
rm -f $HOME/.claude/settings.json
ln -s $DOTFILES/claude/settings.json $HOME/.claude/settings.json
rm -rf $HOME/.claude/commands
ln -s $DOTFILES/claude/commands $HOME/.claude/commands
rm -rf $HOME/.claude/skills
ln -s $DOTFILES/claude/skills $HOME/.claude/skills

echo "macOS dotfiles installation complete!"
